name: Block Ads Update

# Triggers the workflow on manual runs AND on a schedule
on:
  workflow_dispatch:
  schedule:
    # Runs "at minute 0 every hour" (e.g., 1:00, 2:00, 3:00)
    - cron: '0 * * * *'

jobs:
  build-list:
    # This gives the job permission to write to your repo
    permissions:
      contents: write

    # Use the latest Ubuntu runner
    runs-on: ubuntu-latest

    steps:
      # 1. Check out your repository's code
      - name: Check out repository
        uses: actions/checkout@v4

      # 2. Make the shell script executable
      - name: Make script executable
        run: chmod +x block_ads.sh

      # 3. Run the aggregator script
      # This step will now fail if the domain count is over 300k
      - name: Run domain aggregator
        run: ./block_ads.sh
        # This is the new, important part!
        # It passes your GitHub Secrets into the script as environment variables.
        env:
          API_TOKEN: ${{ secrets.API_TOKEN }}
          ACCOUNT_ID: ${{ secrets.ACCOUNT_ID }}
