name: Update Blocklists

on:
  schedule:
    - cron: '0 * * * *'
  
  workflow_dispatch:
    inputs:
      force_update:
        description: 'Force Update (Ignore diffs)'
        type: boolean
        default: false
      nuke_mode:
        description: '☢️ SMART NUKE ☢️'
        type: boolean
        default: false
      dry_run:
        description: 'Dry Run (Simulate only)'
        type: boolean
        default: false

jobs:
  update-blocklists:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install Dependencies
        run: pip install requests

      - name: Run Blocklist Manager
        env:
          API_TOKEN: ${{ secrets.API_TOKEN }}
          ACCOUNT_ID: ${{ secrets.ACCOUNT_ID }}
          WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
        run: |
          FLAGS=""
          
          if [ "${{ inputs.nuke_mode }}" == "true" ]; then
            echo "☢️ NUKE MODE ACTIVE"
            FLAGS="--nuke"
          else
            if [ "${{ inputs.force_update }}" == "true" ]; then
              FLAGS="$FLAGS --force"
            fi
            if [ "${{ inputs.dry_run }}" == "true" ]; then
              FLAGS="$FLAGS --dry-run"
            fi
          fi

          python3 block_ads_sync.py $FLAGS
